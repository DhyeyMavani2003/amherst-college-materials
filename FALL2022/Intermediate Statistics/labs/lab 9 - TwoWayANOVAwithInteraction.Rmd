---
title: "Stat 230 - Lab 9  Two-way ANOVA with Interaction"
author: "P.B. Matheson adopted from A.S. Wagaman"
output:
  pdf_document:
    fig_height: 3
    fig_width: 5
  html_document:
    fig_height: 3
    fig_width: 5
  word_document:
    fig_height: 3
    fig_width: 5
---

This lab continues the bike example (with data wrangling part removed) to allow you to practice two-way ANOVA with interaction. 

```{r, include = FALSE}
library(mosaic)
library(DescTools)
options(digits = 6)
```

### Bike Rentals - Data and Background from UCI Machine Learning Repository

#### Two-Way Additive Model

This dataset contains the hourly and daily count of rental bikes between years 2011 and 2012 in the Capital (Washington D.C.) bikeshare system with the corresponding weather and seasonal information. A little bit of background from UCI's page on the data set: Bike sharing systems are a new generation of traditional bike rentals where the whole process from membership, rental and return back has become automatic. Through these systems, a user is able to easily rent a bike from a particular position and return it at another position. Currently, there are over 500 bike-sharing programs around the world. There is great interest in understanding these systems due to their important role in traffic, environmental and health issues.

Apart from interesting real world applications of bike sharing systems, the characteristics of data being generated by these systems make them attractive for the research. As opposed to other transport services such as bus or subway, the duration of travel, departure and arrival position is explicitly recorded in these systems. This feature turns a bike sharing system into a virtual sensor network that can be used for sensing mobility in the city. Hence, it is expected that most of important events in the city could be detected via monitoring of these data.
  

```{r}
bike <- read.csv("https://pmatheson.people.amherst.edu/stat230/bikerental.csv")
```

The variables included in the data are:

1) season : season (1:spring, 2:summer, 3:fall, 4:winter)  
2) yr : year (0: 2011, 1:2012)  
3) mnth : month (1 to 12)  
4) hr : hour (0 to 23)  
5) holiday : whether day is holiday (1) or not (0)   
6) weekday : day of the week - coded 0 (Sunday) to 6 (Saturday)  
7) workingday : if day is neither weekend nor holiday is 1, otherwise is 0.  
8) weathersit : weather situation with the following levels:  
- 1: Clear, Few clouds, Partly cloudy, Partly cloudy  
- 2: Mist + Cloudy, Mist + Broken clouds, Mist + Few clouds, Mist  
- 3: Light Snow, Light Rain + Thunderstorm + Scattered clouds, Light Rain + Scattered clouds  
- 4: Heavy Rain + Ice Pallets + Thunderstorm + Mist, Snow + Fog  
9) temp : Normalized temperature in Celsius. The values are as a fraction of 41 (max)  
10) atemp: Normalized feeling temperature in Celsius. The values are as a fraction of 50 (max)  
11) hum: Normalized humidity. The values are as a fraction of 100 (max)  
12) windspeed: Normalized wind speed. The values are as a fraction of 67 (max)  
13) casual: count of casual users  
14) registered: count of registered users  
15) cnt: count of total rental bikes including both casual and registered  


```{r}
bike <- mutate(bike, holiday = ifelse(holiday == 1, "Holiday", "Non-Holiday"))
bike <- mutate(bike, weekday = cut(weekday, breaks = c(-.5, .5, 1.5, 2.5, 3.5, 4.5, 5.5, 6.5), labels = c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"), include.lowest = TRUE))
bike <- mutate(bike, workingday = ifelse(workingday == 1, "Work Day", "Non-Work Day"))
bike <- mutate(bike, weathersitc = cut(weathersit, breaks = c(0.5, 1.5, 2.5, 3.5), labels = c("Clear/Clouds", "Mist", "Light Precip"), include.lowest = TRUE))
```

In the first part of the lab, we examined differences in the average number of registered users depending on the weather situation and whether or not it is a holiday. A re-expression of the response was considered there. 

#### Two-Way Model with Interaction

Let's assess now if we need an interaction component in the model we just considered, but with the original response. Note that usually, a statistician would start by determining if interaction was needed, rather than fitting the additive model first.

1. Make an interaction plot that generates lines for the weather levels. Does it appear that there is interaction between holiday and weather level? Why are there only 2 lines?

SOLUTION: (sample code is given below, you have to type in the right variable names)

```{r}
#gf_line(Response ~ Var1, color = ~ Var2, data = bike, group = ~ Var2, stat = "summary")
#adjust line above and be sure you get lines for the correct variable! Lines go with Var2!
gf_line(registered ~ holiday, color = ~ weathersitc, data = bike, 
        group = ~ weathersitc, stat = "summary", fun.y = "mean")
favstats(registered ~ holiday | weathersitc, data=bike)
gf_boxplot(casual ~ weathersitc| holiday, data = bike)

```

2. Make an interaction plot that generates lines for holidays and non-holidays. Does it appear that there is interaction between holiday and weather level?

SOLUTION:

```{r}

```


3. Fit an appropriate model with interaction. Check conditions and re-express the response as necessary until you believe conditions are met.

SOLUTION:

```{r}

```


4. Determine whether or not the interaction between weather and holiday is significant. State your test statistic, p-value, and conclusion. 

SOLUTION:


#### Choose Your Own Two-Way Model 

Investigate the behavior of *casual* bike users. You might expect some differences between how registered and casual bike users behave.

5. What are some differences you might expect in the behavior of casual users compared to registered users?

SOLUTION:

6. Investigate appropriate graphs and descriptive statistics to shed light on how the number of casual users is related to weather situation and whether or not it is a workday. Do you see any possible concerns with performing a two-way ANOVA?

SOLUTION:

```{r}

```


7. Assess with plots whether or not you'd like to fit an interaction term in the model.

SOLUTION:

```{r}

```


8. Fit an appropriate model to determine whether there are differences in the average number of (possibly re-expressed) casual users depending on the weather situation and whether or not it is a workday, building in interaction if you feel it is necessary. Be sure you check your model conditions.

SOLUTION:

```{r}

```


9. If you added an interaction term, is it significant? If you find it is not, refit your model without it.

SOLUTION:

10. Interpret the main effects, if appropriate. If not appropriate, explain why not.

SOLUTION:

11. If differences are present, use appropriate procedures to identify them.

SOLUTION:

